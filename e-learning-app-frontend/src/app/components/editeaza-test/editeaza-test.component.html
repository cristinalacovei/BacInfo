<div class="test-container" *ngIf="testForm">
  <form [formGroup]="testForm" (ngSubmit)="salveazaModificari()">
    <div formArrayName="questions">
      <ng-container *ngIf="getQuestions().controls.length > 0">
        <div
          *ngFor="let question of getQuestions().controls; let i = index"
          [formGroupName]="i"
          [hidden]="i !== currentQuestionIndex"
          class="question-card"
        >
          <div class="question-header">
            <input
              type="text"
              formControlName="questionText"
              placeholder="Întrebarea {{ i + 1 }}"
            />
            <button
              class="delete-question"
              type="button"
              (click)="confirmaStergereIntrebare(i)"
              title="Șterge întrebare"
            >
              🗑️
            </button>
          </div>

          <select formControlName="questionType">
            <option value="SINGLE_CHOICE">Răspuns unic</option>
            <option value="MULTIPLE_CHOICE">Răspunsuri multiple</option>
          </select>

          <div formArrayName="answers" class="answers">
            <div
              *ngFor="let answer of getAnswers(i).controls; let j = index"
              [formGroupName]="j"
              class="answer-item"
            >
              <div class="answer-row">
                <input
                  type="text"
                  formControlName="answerText"
                  placeholder="Răspuns {{ j + 1 }}"
                />

                <div class="answer-controls">
                  <input
                    *ngIf="isSingleChoice(i)"
                    type="radio"
                    name="single{{ i }}"
                    [checked]="answer.get('isCorrect')?.value"
                    (change)="selectSingle(i, j)"
                  />

                  <input
                    *ngIf="isMultipleChoice(i)"
                    type="checkbox"
                    formControlName="isCorrect"
                  />

                  <button
                    class="delete-answer"
                    type="button"
                    (click)="confirmaStergereRaspuns(i, j)"
                    title="Șterge răspuns"
                  >
                    🗑️
                  </button>
                </div>
              </div>
            </div>
          </div>

          <button class="add-answer" type="button" (click)="adaugaRaspuns(i)">
            ➕ Adaugă Răspuns
          </button>
        </div>
      </ng-container>
    </div>

    <div class="button-group">
      <button
        mat-raised-button
        color="accent"
        type="button"
        (click)="prevQuestion()"
        [disabled]="currentQuestionIndex === 0"
      >
        ⬅ Înapoi
      </button>

      <button
        mat-raised-button
        color="primary"
        type="button"
        (click)="nextQuestion()"
        [disabled]="currentQuestionIndex === getQuestions().length - 1"
      >
        Următoarea ➔
      </button>
    </div>

    <div class="submit-container">
      <button mat-raised-button color="primary" type="submit">
        📅 Salvează Modificările
      </button>
      <button
        mat-raised-button
        color="accent"
        type="button"
        (click)="adaugaIntrebare()"
      >
        ➕ Adaugă Întrebare
      </button>
    </div>
  </form>
</div>
